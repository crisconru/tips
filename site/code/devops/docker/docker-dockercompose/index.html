<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Docker Compose - Tips de Cristo</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Docker Compose", url: "#_top", children: [
              {title: "Instalaci\u00f3n de Docker Compose", url: "#instalacion-de-docker-compose" },
              {title: "docker-compose up - Levantar contenedores con docker-compose", url: "#docker-compose-up-levantar-contenedores-con-docker-compose" },
              {title: "docker-compose down - Parar y eliminar todo lo que ha hecho docker-compose", url: "#docker-compose-down-parar-y-eliminar-todo-lo-que-ha-hecho-docker-compose" },
              {title: "Estructura", url: "#estructura" },
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../ides/vscode/vscode/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../ides/vscode/vscode/" class="btn btn-xs btn-link">
        Visual Studio code
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../docker-network/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../docker-network/" class="btn btn-xs btn-link">
        Network
      </a>
    </div>
    
  </div>

    

    <h1 id="docker-compose">Docker Compose</h1>
<p>Información oficial -&gt; <a href="https://docs.docker.com/compose/">aquí</a></p>
<p>Es para aplicaciones multicontenedor.</p>
<p>La nomenclatura que se sigue a la hora de nombrar el fichero es <code>docker-compose-&lt;nombre&gt;.yml</code>, y su formato es <code>YAML</code>. Si no se especifica nada, el fichero tiene que llamarse <code>docker-compose.yml</code>.</p>
<h2 id="instalacion-de-docker-compose">Instalación de Docker Compose</h2>
<p>Información oficial -&gt; <a href="https://docs.docker.com/compose/install/">aquí</a></p>
<pre><code class="bash">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
</code></pre>

<h2 id="docker-compose-up-levantar-contenedores-con-docker-compose"><code>docker-compose up</code> - Levantar contenedores con docker-compose</h2>
<pre><code class="bash">docker-compose up [&lt;opciones&gt;] [--scale &lt;servicio&gt;=&lt;numero-instancias&gt;] [&lt;servicio1&gt; &lt;servicio2&gt; ...]
</code></pre>

<p>Con este comando lanza docker-compose y ejecuta el fichero por defecto <code>docker-compose.yml</code>.</p>
<pre><code class="bash">docker-compose [-p &lt;nombre-proyecto&gt;] up [-d]
</code></pre>

<p>Si queremos que levante un fichero docker-compose especifico, hacemos</p>
<pre><code class="bash">docker-compose [-p &lt;nombre-proyecto&gt;] -f &lt;fichero-docker-compose&gt; up [-d]
</code></pre>

<h2 id="docker-compose-down-parar-y-eliminar-todo-lo-que-ha-hecho-docker-compose"><code>docker-compose down</code> - Parar y eliminar todo lo que ha hecho docker-compose</h2>
<pre><code class="bash">docker-compose [-f &lt;fichero-docker-compose&gt;] down [-d]
</code></pre>

<h2 id="estructura">Estructura</h2>
<p>Tiene cuatro secciones:</p>
<ul>
<li><code>version</code> -&gt; Indica la version de Docker-Compose que se va a usar (poner <code>'3'</code> a menos que).<ul>
<li>Es OBLIGATORIA</li>
</ul>
</li>
<li><code>services</code> -&gt; Son los distintos servicios / contenedores que se van a crear<ul>
<li>Es OBLIGATORIA</li>
</ul>
</li>
<li><code>volumes</code> -&gt; opcional</li>
<li><code>networks</code> -&gt; opcional</li>
</ul>
<pre><code class="yml">version:
services:
volumes:
networks:
</code></pre>

<p>Un ejemplo con un contenedor de nginx. Si fuera por comandos haríamos</p>
<pre><code class="bash">docker run -d --name nginx nginx
</code></pre>

<p>Con docker-compose</p>
<pre><code class="yml">version: '3'
services:
  web:
    container_name: nginx1
    ports:
      - &quot;8080:80&quot;
    image: nginx
</code></pre>

<p>Y para lanzarlo</p>
<pre><code class="bash">docker-compose up -d
</code></pre>

<p>Para eliminar todo lo que ha hecho el anterior fichero hacemos</p>
<pre><code class="bash">docker-compose down
</code></pre>

<h3 id="services">services</h3>
<ul>
<li><code>container_name</code> -&gt; Nombre del contenedor</li>
<li><code>image</code> -&gt; Imagen con la que se va a crear</li>
<li><code>build</code> -&gt; Ruta hasta el <code>Dockerfile</code> usar una imagen propia</li>
</ul>
<p>Versión corta</p>
<pre><code class="yml">version: '3'
services:
  web:
build: .
</code></pre>

<p>Versión extendida</p>
<pre><code class="yml">version: '3'
services:
webapp:
  build:
  context: ./dir
  dockerfile: mi-dockerfile
  args:
    buildno: 1
</code></pre>

<ul>
<li><code>command</code> -&gt; Mandarle un comando, sobreescribiendo el del <code>Dockerfile</code> (si lo hubiera).</li>
<li><code>ports</code> -&gt; Exponer los puertos</li>
<li><code>restart</code> -&gt; Política de reinicio (información <a href="https://docs.docker.com/config/containers/start-containers-automatically/">aquí</a>)<ul>
<li><code>no</code> -&gt; Por defecto.</li>
<li><code>on-failure</code> -&gt; Reiniciar el contenedor si hay un error.</li>
<li><code>always</code> -&gt; Reiniciar si el contenedor se para (si se ha parado a mano, se reiniciará cuando se reinicie el demonio de docker).</li>
<li><code>unless-stopped</code> -&gt; Parecido a <code>always</code> pero no se reinicia cuando se reinicia el demonio de docker.</li>
</ul>
</li>
</ul>
<h3 id="volumes">volumes</h3>
<pre><code class="yml">version: &quot;3.2&quot;
services:
  web:
    image: nginx:alpine
    volumes:
      - type: volume
        source: mydata
        target: /data
        volume:
          nocopy: true
      - type: bind
        source: ./static
        target: /opt/app/static

  db:
    image: postgres:latest
    volumes:
      - &quot;/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock&quot;
      - &quot;dbdata:/var/lib/postgresql/data&quot;

volumes:
  mydata:
  dbdata:
</code></pre>

<h3 id="networks">networks</h3>
<pre><code class="yml">version: '3'
services:
  web:
    networks:
     - some-network
     - other-network
networks:
  some-network:
  other-network:
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../ides/vscode/vscode/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../ides/vscode/vscode/" class="btn btn-xs btn-link">
        Visual Studio code
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../docker-network/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../docker-network/" class="btn btn-xs btn-link">
        Network
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>